# 智选车平台协作开发文档

## 1. 权限认证 (Sa-Token)

### 1.1 认证配置
- 统一使用 Sa-Token 进行认证和授权
- Token 配置在 `application.yml` 中的 `sa-token` 节点下
- Token 通过 HTTP Header 的 `Authorization` 字段传递

### 1.2 权限设计
权限码格式：`对象:操作`，例如：`user:create`

#### 基础权限（所有用户）
- `user:profile:view` - 查看个人资料
- `user:profile:edit` - 编辑个人资料

#### 管理员权限
- `user:*` - 用户管理所有权限
- `dealer:*` - 经销商管理所有权限
- `car:*` - 车辆管理所有权限
- `system:*` - 系统管理所有权限

#### 经销商权限
- `dealer:info:edit` - 编辑经销商信息
- `car:add` - 添加车辆
- `car:edit` - 编辑车辆
- `car:delete` - 删除车辆
- `order:view` - 查看订单
- `order:process` - 处理订单

#### 普通用户权限
- `car:view` - 查看车辆
- `car:favorite` - 收藏车辆
- `order:create` - 创建订单
- `order:cancel` - 取消订单
- `review:add` - 添加评价

### 1.3 角色设计
- `admin` - 管理员
- `dealer` - 经销商
- `normal_user` - 普通用户

## 2. API 规范

### 2.1 RESTful 规范
- GET：查询资源
- POST：创建资源
- PUT：更新资源
- DELETE：删除资源

### 2.2 URL 规范
- 使用小写字母
- 使用连字符（-）连接单词
- 使用复数形式表示资源集合
- 例如：`/api/users`, `/api/dealers`

### 2.3 响应格式
统一使用 `ApiResponse` 封装：
```json
{
    "code": 200,
    "message": "操作成功",
    "data": null
}
```

### 2.4 状态码
- 200：成功
- 400：客户端错误
- 401：未认证
- 403：无权限
- 404：资源不存在
- 500：服务器错误

## 3. Swagger/OpenAPI 规范

### 3.1 注解使用
- `@Tag` - 标记控制器分类
- `@Operation` - 描述接口功能
- `@Parameter` - 描述参数
- `@SecurityRequirement` - 标记需要认证
- `@Schema` - 描述数据模型
- `@MapperScan("com.zhixuanche.user.mapper")` - 扫描 Mapper 接口

### 3.2 文档说明
- 接口必须包含概要说明和详细描述
- 参数必须包含说明、是否必填、示例值
- 响应必须包含成功和失败的示例

### 3.3 访问地址
- Swagger UI：`/api/swagger-ui.html`
- OpenAPI JSON：`/api/v3/api-docs`

## 4. API 访问规范

### 4.1 认证方式
- 登录获取 token
- 请求头携带 token：`Authorization: ${token}`

### 4.2 跨域处理
- 已配置 CORS，支持跨域访问
- 允许的请求方法：GET、POST、PUT、DELETE、OPTIONS
- 允许的请求头：Authorization 等

### 4.3 数据验证
- 使用 Jakarta Validation 进行参数校验
- DTO 类中使用注解定义验证规则
- 控制器方法使用 `@Valid` 开启验证

## 5. 开发注意事项

### 5.1 代码规范
- 遵循阿里巴巴 Java 开发手册
- 使用统一的代码格式化配置
- 添加必要的注释和文档

### 5.2 异常处理
- 使用全局异常处理器
- 业务异常需要定义明确的错误码和信息
- 敏感信息不允许在错误信息中返回

### 5.3 日志规范
- 使用 SLF4J + Logback
- 按照级别合理使用日志
- 敏感信息不允许打印到日志

### 5.4 提交规范
- 每次提交前进行代码格式化
- 提交信息需要清晰描述改动内容

